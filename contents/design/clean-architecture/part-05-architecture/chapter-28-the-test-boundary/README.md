# THE TEST BOUNDARY

테스트는 시스템의 일부이며, 아키텍처에도 관여한다.

## 시스템 컴포넌트인 테스트

아키텍처 관점에서는 모든 테스트가 동일하다. 테스트는 태생적으로 의존성 규칙을 따른다. 테스트는 세부적이며 구체적인 것으로, 의존성은 항상 테스트 대상이 되는 코드를 향한다. 테스트는 아키텍처에서 가장 바깥쪽 원으로
생각할 수 있다.

테스트는 독립적으로 배포 가능하다.

테스트는 시스템 컴포넌트 중 가장 고립되어 있다. 테스트가 시스템 운영에 꼭 필요하지 않으며, 어떤 사용자도 테스트에 의존하지 않는다. 그렇다고 해서 테스트가 시스템 컴포넌트가 아니라는 뜻은 아니다. 테스트는 다른
모든 시스템 컴포넌트가 반드시 지켜야 하는 모델을 표현해준다.

## 테스트를 고려한 설계

테스트가 시스템 설계와 잘 통합되지 않으면, 테스트는 깨지기 쉬워지고, 시스템은 뻣뻣해져 변경하기가 어려워진다. 시스템에 강하게 결합된 테스트라면 시스템이 변경될 때 함께 변경되어야만 한다. 시스템 컴포넌트에서 생긴
변경은 이와 결합된 테스트를 망가뜨릴 수 있다. 이 문제는 깨지기 쉬운 테스트 문제(Fragile Tests Problem)으로 알려져 있다.

예를 들어 GUI를 사용하여 업무 규칙을 검증하는 테스트가 있다고 하자. 이러한 테스트들은 로그인 화면에서 시작해 페이지 구조를 탐색해 나가며 특정 업무 규칙을 검사한다. 따라서 로그인 페이지나 탐색 구조 어딘가가
달라지면 엄청난 수의 테스트가 망가진다.

이러한 문제들을 해결하려면 테스트를 고려해 설계해야 한다. 소프트웨어의 첫 번째 규칙은 언제나 같다. 변동성이 있는 것에 의존하지 말아야 한다. GUI는 변동성이 크므로, GUI를 사용하지 않고 업무 규칙을 테스트할
수 있게 만들어야 한다.

## 테스트 API

이를 만족하려면 테스트가 모든 업무 규칙을 검증하는 데 사용할 수 있도록 특화된 API를 만들면 된다. 이러한 API는 보안 제약사항을 무시할 수 있으며, (데이터베이스와 같은) 값비싼 자원은 건너뛰고, 시스템을
테스트 가능한 특정 상태로 강제하는 힘을 지녀야 한다. 이 API는 사용자 인터페이스가 사용하는 인터랙터(Interactor)와 인터페이스 어댑터(Interface Adapter)들의 상위 집합이 될 것이다. 

테스트 API는 테스트 애플리케이션으로부터 분리할 목적으로 사용한다. 테스트 구조를 애플리케이션 구조로부터 결합을 분리하는 것이 목표이다.

### 구조적 결합

테스트 API의 역할은 애플리케이션의 구조를 테스트로부터 숨기는 데 있다. 이렇게 만들면 사용 코드를 리팩터링하거나 진화시키더라도 테스트에는 전혀 영향을 주지 않는다. 반대의 경우도 동일하다. 

이처럼 따로따로 진화할 수 있다는 점은 필수적인데, 시간이 지날수록 테스트는 계속해서 더 구체적으로 특화된 형태로 변할 것이고, 반대로 상용 코드는 더 추상적이고, 범용적인 형태로 변할 것이기 때문이다.

### 보안

테스트 API가 지닌 강력한 힘들 운영 시스템에 배포하면 위험에 처할 수 있다. 이러한 문제를 해결하려면 테스트 API 자체와 테스트 API 중 위험한 부분의 구현부는 독립적으로 배포할 수 있는 컴포넌트로 분리해야 한다. 

## 결론

테스트는 시스템의 일부이므로 잘 설계되어야 한다. 
